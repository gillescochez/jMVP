(function(){var t=function(o,e,i){this.oRawModel=o,this.oRawView=e,this.oRawPresenter=i,this.model=new t.Model(o),this.view=new t.View(e,!0),this.presenter=new t.Presenter(i,this.view,this.model),this.addModelListener(),this.applyModelToView()};t.prototype.addModelListener=function(){this.model.onModelUpdated=function(t,o){this.view.update(t,o)}.bind(this)},t.prototype.applyModelToView=function(){t.each(this.oRawModel,function(t,o){this.view.update(t,o)},this)},t.prototype.getModel=function(){return this.model},t.prototype.getView=function(){return this.view},t.prototype.getPresenter=function(){return this.presenter},t.prototype.getRawModel=function(){return this.oRawModel},t.prototype.getRawView=function(){return this.oRawView},t.prototype.getRawPresenter=function(){return this.oRawPresenter},t.dom=function(o){return new t.dom.Wrap(o)},t.dom.createNode=function(t){return document.createElement(t||"div")},t.dom.Wrap=function(t){if(!t)throw"jMVP.dom.Wrap requires a node or node list object";return this.aNodes=t[1]?Array.prototype.slice.call(t):t[0]?t:[t],this},t.dom.Wrap.prototype.each=function(o){return t.each(this.aNodes,function(t){o.apply(t)}),this},t.dom.Wrap.prototype.on=function(o,e){return this.each(function(){t.dom.on(this,o,e)})},t.dom.Wrap.prototype.off=function(o,e){return this.each(function(){t.dom.off(this,o,e)})},t.dom.Wrap.prototype.addClass=function(t){return this.each(function(){this.className+=" "+t})},t.dom.Wrap.prototype.removeClass=function(t){return this.each(function(){this.className=void 0!==this.className?this.className.replace(RegExp(" "+t,"gi"),""):""})},t.dom.Wrap.prototype.text=function(o){return this.each(function(){this[t.dom.INNER_TEXT]=o})},t.dom.Wrap.prototype.html=function(t){return this.each(function(){this.innerHTML=t})},t.dom.Wrap.prototype.setAttr=function(t,o){return this.each(function(){this.setAttribute(t,o)})},t.dom.Wrap.prototype.rmAttr=function(t){return this.each(function(){this.removeAttribute(t)})},t.dom.Wrap.prototype.display=function(t){var o=t!==!1?"":"none";return this.each(function(){this.style.display=o})},t.dom.DIV=document.createElement("div"),t.dom.INNER_TEXT="innerText"in t.dom.DIV?"innerText":"textContent",t.dom.on=t.dom.DIV.addEventListener?function(t,o,e){t.addEventListener(o,e,!1)}:function(t,o,e){t.attachEvent("on"+o,e)},t.dom.off=t.dom.DIV.removeEventListener?function(t,o,e){t.removeEventListener(o,e)}:function(t,o,e){t.detachEvent("on"+o,e)},t.Model=function(o){t.each(o,function(e){t.Model.dataBind(this,o,e)},this)},t.Model.prototype.onModelUpdated=function(){},t.Model.dataBind=function(o,e,i){o[i]=function(t){return void 0!==t&&o[i].oData.setValue(t),o[i].oData.getValue()},o[i].oData=new t.Data(e[i]),o[i].oData.onValueUpdated=function(t){e[i]=t,o.onModelUpdated.apply(o,[i,t])}},t.Data=function(t){this.vValue=t},t.Data.prototype.setValue=function(t){this.vValue=t,this.onValueUpdated(this.vValue)},t.Data.prototype.getValue=function(){return this.vValue},t.Data.prototype.onValueUpdated=function(){},t.Presenter=function(o,e,i){this.oMap={},this.view=e||null,this.model=i||null,this.oConfig=o,t.each(o,function(t,o){this.oMap[t]=o,this.view&&this.bindToView(t)},this)},t.Presenter.prototype.bindToView=function(o){var e=this.view,i=this.model;t.each(this.oMap[o],function(n,r){var s=e.getNode(o);t.dom(s).on(n,function(t){r.apply(s,[t,i,e])})})},t.Presenter.prototype.routeEvent=function(o){var e,i=o.target;t.each(-1!==i.className.indexOf(" ")?i.className.split(" "):[i.className],function(t){"jMVP"===t.substring(0,4)&&(e=t.substring(5,t.length),this.oMap.hasOwnProperty(e)&&this.oMap[e][o.type]&&this.oMap[e][o.type].apply(i,[o,this.view,this.model]))},this)},t.Presenter.prototype.getConfig=function(){return this.oConfig},t.Presenter.prototype.getMap=function(){return this.oMap},t.Presenter.prototype.isInMap=function(t){return this.oMap[t]?!0:!1},t.Presenter.prototype.getModel=function(){return this.model},t.Presenter.prototype.getView=function(){return this.view},t.each=function(t,o,e){var i;if(t.constructor===Object&&t.constructor!==Array)for(i in t)t[i]&&o.apply(e,[i,t[i]]);else("string"==typeof t||t instanceof Array)&&("string"==typeof t?t.split(""):t).forEach(function(t,i){o.apply(e,[t,i])})},t.error=function(t,o){throw Error(t+" - Error: "+o)},t.View=function(o,e){return o?(this.oConfig=o,this.oNodeMap={},this.oLoopMap={},this.oRefMap={},this.eDomView=t.View.emptyDomView(o),e&&this.parse(),void 0):(t.error("jMVP.View: Configuration object missing!",101),void 0)},t.View.prototype.parse=function(o,e){t.each(o||this.oConfig,function(t,o){var i=this.createNode(t,o.tag);this.storeNode(t,i),(e||this.eDomView).appendChild(i),o.children&&this.parse(o.children,i),o.hook&&this.hook(o.hook,i),o.loop&&this.storeLoop(o.loop,i)},this)},t.View.prototype.update=function(t,o){this.oRefMap[t]&&(("string"==typeof o||o.constructor==Boolean)&&this.applyHooks(t,o),o.constructor==Array&&this.applyHooks(t,o.join(", "))),this.oLoopMap[t]&&this.loop(t,o)},t.View.prototype.loop=function(o,e){var i=e.length;t.each(this.oLoopMap[o],function(n){t.each(n.template,function(o,e){var r=this.oNodeMap[o],s=r?r.length:0,a=0;0===s?a=i:s!==i&&i>s&&(a=i-s),this.doNodes(a,e.tag,o),r=this.oNodeMap[o],t.each(r,function(t){n.parent.appendChild(t),this.hook(e.hook,t)},this)},this),this.applyHooks(o,e)},this)},t.View.prototype.doNodes=function(t,o,e){for(var i=0;t>i;i++){var n=this.createNode(e,o);this.storeNode(e,n)}},t.View.prototype.storeLoop=function(t,o){var e=t.source;t.parent=o,this.oLoopMap[e]||(this.oLoopMap[e]=[]),this.oLoopMap[e].push(t)},t.View.prototype.hook=function(o,e){t.each(o,function(o,i){t.View.hooks[o]&&this.storeHook(e,o,i)},this)},t.View.prototype.storeHook=function(o,e,i){"string"==typeof i?(this.oRefMap[i]||(this.oRefMap[i]={}),this.oRefMap[i][e]||(this.oRefMap[i][e]=[]),this.oRefMap[i][e].push(o)):t.each(i,function(t,i){this.oRefMap[i]||(this.oRefMap[i]={}),this.oRefMap[i][e]||(this.oRefMap[i][e]={}),this.oRefMap[i][e][t]||(this.oRefMap[i][e][t]=[]),this.oRefMap[i][e][t].push(o)},this)},t.View.prototype.applyHooks=function(o,e){var i=e.constructor==Array?e:[e];t.each(this.oRefMap[o]||[],function(o,e){e[0]?t.each(i,function(i,n){t.View.hooks[o](e[n],i)}):t.each(e,function(e,n){t.each(i,function(i,r){t.View.hooks[o](n[r],e,i)})})})},t.View.prototype.createNode=function(o,e){var i=t.dom.createNode(e);return i.className=o,i},t.View.prototype.storeNode=function(t,o){if(this.oNodeMap[t]){if(this.oNodeMap[t].constructor!=Array){var e=this.oNodeMap[t];this.oNodeMap[t]=[],this.oNodeMap[t].push(e)}this.oNodeMap[t].push(o)}else this.oNodeMap[t]=o},t.View.prototype.render=function(t){t.appendChild(this.eDomView),this.eDomView=t.childNodes[t.childNodes.length-1]},t.View.prototype.isInMap=function(t){var o=this.oMap[t]||this.oLoopMap[t]||null;return o?!0:!1},t.View.prototype.getConfig=function(){return this.oConfig},t.View.prototype.getNodeMap=function(){return this.oNodeMap},t.View.prototype.getNode=function(t){return this.oNodeMap[t]||null},t.View.prototype.getLoopMap=function(){return this.oLoopMap},t.View.prototype.getRefMap=function(){return this.oRefMap},t.View.prototype.getDomView=function(){return this.eDomView},t.View.hooks={text:function(o,e){t.dom(o).text(e)},html:function(o,e){t.dom(o).html(e)},attr:function(o,e,i){t.dom(o)[(i===!1||null===i?"rm":"set")+"Attr"](e,i)},css:function(o,e,i){t.dom(o)[(i?"add":"remove")+"Class"](e)},display:function(o,e){t.dom(o).display(e)}},t.View.emptyDomView=function(o){var e;return o.tag?(e=t.dom.createNode(o.tag),delete o.tag):e=t.dom.createNode(),o.id&&(e.id=o.id,delete o.id),o.className&&(e.className=o.className,delete o.className),e},window.jMVP=t})();