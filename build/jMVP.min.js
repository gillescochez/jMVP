(function(){var t=function(e,o,n){this.oRawModel=e,this.oRawView=o,this.oRawPresenter=n,this.model=new t.Model(e),this.view=new t.View(o),this.presenter=new t.Presenter(n,this.view,this.model),this.addModelListener(),this.applyModelToView()};t.prototype.addModelListener=function(){this.model.onModelUpdated=function(t,e){this.view.update(t,e)}.bind(this)},t.prototype.applyModelToView=function(){t.each(this.oRawModel,function(t,e){this.view.isInMap(t)&&this.view.update(t,e)},this)},t.prototype.getModel=function(){return this.model},t.prototype.getView=function(){return this.view},t.prototype.getPresenter=function(){return this.presenter},t.prototype.getRawModel=function(){return this.oRawModel},t.prototype.getRawView=function(){return this.oRawView},t.prototype.getRawPresenter=function(){return this.oRawPresenter},t.Model=function(e){t.each(e,function(o){t.Model.dataBind(this,e,o)},this)},t.Model.prototype.onModelUpdated=function(){},t.Model.dataBind=function(e,o,n){e[n]=new t.Data(o[n]),e[n].onValueUpdated=function(t){o[n]=t,e.onModelUpdated.apply(e,[n,t])}},t.Data=function(t){this.vValue=t},t.Data.prototype.setValue=function(t){this.vValue=t,this.onValueUpdated(this.vValue)},t.Data.prototype.getValue=function(){return this.vValue},t.Data.prototype.onValueUpdated=function(){},t.Presenter=function(e,o,n){this.oMap={},this.view=o||null,this.model=n||null,this.oConfig=e,t.each(e,function(t,e){this.oMap[t]=e,this.view&&this.bindToView(t)},this)},t.Presenter.prototype.bindToView=function(e){var o=this.view,n=this.model;t.each(this.oMap[e],function(i,r){var s=this.view.getElement(e);t.dom(s).on(i,function(t){r.apply(s,[t,n,o])})},this)},t.Presenter.prototype.routeEvent=function(e){var o,n=e.target;t.each(-1!==n.className.indexOf(" ")?n.className.split(" "):[n.className],function(t){"jMVP"===t.substring(0,4)&&(o=t.substring(5,t.length),this.oMap.hasOwnProperty(o)&&this.oMap[o][e.type]&&this.oMap[o][e.type].apply(n,[e,this.view,this.model]))},this)},t.Presenter.prototype.getConfig=function(){return this.oConfig},t.Presenter.prototype.getMap=function(){return this.oMap},t.Presenter.prototype.isInMap=function(t){return this.oMap[t]?!0:!1},t.Presenter.prototype.getModel=function(){return this.model},t.Presenter.prototype.getView=function(){return this.view},t.View=function(t){this.oConfig=t,this.oMap={},this.oNodesMap={},this.oLoopMap={},this.eDomView=this.generate(t)},t.View.prototype.update=function(e,o){t.each(this.oMap[e],function(e,n){"attributes"==e||"classNames"==e?t.each(n,function(n,i){t.View.hooks[e](i,o,n)}):t.View.hooks[e](n,o)},this)},t.View.prototype.generate=function(e,o){var n=o||document.createElement("div");return t.each(e,function(t,e){var o=document.createElement(e.tag||"div");this.oNodesMap[t]=o,o.className=t,this.mapHooks(t,e,o),e.loop&&this.mapLoop(t,e.loop,o),e.children&&this.generate(e.children,o),n.appendChild(o)},this),n},t.View.prototype.mapHooks=function(e,o,n){t.each(t.View.hooks,function(e){o[e]&&("attributes"===e||"classNames"===e?t.each(o[e],function(t,o){this.oMap[o]||(this.oMap[o]={}),this.oMap[o][e]||(this.oMap[o][e]={}),this.oMap[o][e][t]||(this.oMap[o][e][t]=[]),this.oMap[o][e][t].push(n)},this):(this.oMap[o[e]]||(this.oMap[o[e]]={}),this.oMap[o[e]][e]||(this.oMap[o[e]][e]=[]),this.oMap[o[e]][e].push(n)))},this)},t.View.prototype.mapLoop=function(e,o,n){o.source&&o.template||t.error("View loop object require both a source and template"),this.oLoopMap[e]={config:o,node:n}},t.View.prototype.render=function(t){t.appendChild(this.eDomView),this.eDomView=t.childNodes[t.childNodes.length-1]},t.View.prototype.getConfig=function(){return this.oConfig},t.View.prototype.getMap=function(){return this.oMap},t.View.prototype.isInMap=function(t){return this.oMap[t]?!0:!1},t.View.prototype.getElement=function(t){return this.oNodesMap[t]||null},t.View.prototype.getDOM=function(){return this.eDomView},t.View.hooks={text:function(e,o){t.dom(e).text(o)},html:function(e,o){t.dom(e).html(o)},attributes:function(e,o,n){t.dom(e)[(o===!1||null===o?"rm":"set")+"Attr"](n,o)},classNames:function(e,o,n){t.dom(e)[(o?"add":"remove")+"Class"](n)}},t.dom=function(e){return new t.dom.Wrap(e)},t.dom.Wrap=function(t){if(!t)throw"jMVP.dom.Wrap requires a node or node list object";return this.aNodes=t[1]?Array.prototype.slice.call(t):t[0]?t:[t],this},t.dom.Wrap.prototype.each=function(e){return t.each(this.aNodes,function(t){e.apply(t)}),this},t.dom.Wrap.prototype.on=function(e,o){return this.each(function(){t.dom.on(this,e,o)})},t.dom.Wrap.prototype.off=function(e,o){return this.each(function(){t.dom.off(this,e,o)})},t.dom.Wrap.prototype.addClass=function(t){return this.each(function(){this.className+=" "+t})},t.dom.Wrap.prototype.removeClass=function(t){return this.each(function(){this.className=void 0!==this.className?this.className.replace(RegExp(" "+t,"gi"),""):""})},t.dom.Wrap.prototype.text=function(e){return this.each(function(){this[t.dom.INNER_TEXT]=e})},t.dom.Wrap.prototype.html=function(t){return this.each(function(){this.innerHTML=t})},t.dom.Wrap.prototype.setAttr=function(t,e){return this.each(function(){this.setAttribute(t,e)})},t.dom.Wrap.prototype.rmAttr=function(t){return this.each(function(){this.removeAttribute(t)})},t.dom.DIV=document.createElement("div"),t.dom.INNER_TEXT="innerText"in t.dom.DIV?"innerText":"textContent",t.dom.on=t.dom.DIV.addEventListener?function(t,e,o){t.addEventListener(e,o,!1)}:function(t,e,o){t.attachEvent("on"+e,o)},t.dom.off=t.dom.DIV.removeEventListener?function(t,e,o){t.removeEventListener(e,o)}:function(t,e,o){t.detachEvent("on"+e,o)},t.each=function(t,e,o){var n;if(t.constructor===Object&&t.constructor!==Array)for(n in t)t[n]&&e.apply(o,[n,t[n]]);else("string"==typeof t||t instanceof Array)&&("string"==typeof t?t.split(""):t).forEach(function(t,n){e.apply(o,[t,n])})},t.error=function(t,e){if(!window.console||!console.error)throw t+""+e;console.error(t,e)},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var o=0,n=this.length;n>o;o++)o in this&&t.call(e,this[o],o,this)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),o=this,n=function(){},i=function(){return o.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i}),window.jMVP=t})();