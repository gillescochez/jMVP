(function(){var t=function(e,o,i){this.rawModel=e,this.rawView=o,this.rawPresenter=i,this.model=new t.Model(e),this.view=new t.View(o,!0),this.presenter=new t.Presenter(i,this.view,this.model),this.addModelListener(),this.applyModelToView()};t.prototype.addModelListener=function(){this.model.onModelUpdated=function(t,e){this.view.update(t,e)}.bind(this)},t.prototype.applyModelToView=function(){t.each(this.rawModel,function(t,e){this.view.update(t,e)},this)},t.prototype.getModel=function(){return this.model},t.prototype.getView=function(){return this.view},t.prototype.getPresenter=function(){return this.presenter},t.prototype.getRawModel=function(){return this.rawModel},t.prototype.getRawView=function(){return this.rawView},t.prototype.getRawPresenter=function(){return this.rawPresenter},t.dom=function(e){return new t.dom.Wrap(e)},t.dom.createNode=function(t){return document.createElement(t||"div")},t.dom.Wrap=function(t){if(!t)throw"jMVP.dom.Wrap requires a node or node list object";return this.nodes=t[1]?Array.prototype.slice.call(t):t[0]?t:[t],this},t.dom.Wrap.prototype.each=function(e){return t.each(this.nodes,function(t){e.apply(t)}),this},t.dom.Wrap.prototype.on=function(e,o){return this.each(function(){t.dom.on(this,e,o)})},t.dom.Wrap.prototype.off=function(e,o){return this.each(function(){t.dom.off(this,e,o)})},t.dom.Wrap.prototype.addClass=function(t){return this.each(function(){this.className+=" "+t})},t.dom.Wrap.prototype.removeClass=function(t){return this.each(function(){this.className=void 0!==this.className?this.className.replace(RegExp(" "+t,"gi"),""):""})},t.dom.Wrap.prototype.text=function(e){return this.each(function(){this[t.dom.INNER_TEXT]=e})},t.dom.Wrap.prototype.html=function(t){return this.each(function(){this.innerHTML=t})},t.dom.Wrap.prototype.setAttr=function(t,e){return this.each(function(){this.setAttribute(t,e)})},t.dom.Wrap.prototype.rmAttr=function(t){return this.each(function(){this.removeAttribute(t)})},t.dom.Wrap.prototype.display=function(t){var e=t!==!1?"":"none";return this.each(function(){this.style.display=e})},t.dom.DIV=document.createElement("div"),t.dom.INNER_TEXT="innerText"in t.dom.DIV?"innerText":"textContent",t.dom.on=t.dom.DIV.addEventListener?function(t,e,o){t.addEventListener(e,o,!1)}:function(t,e,o){t.attachEvent("on"+e,o)},t.dom.off=t.dom.DIV.removeEventListener?function(t,e,o){t.removeEventListener(e,o)}:function(t,e,o){t.detachEvent("on"+e,o)},t.Model=function(e){t.each(e,function(o){t.Model.dataBind(this,e,o)},this)},t.Model.prototype.onModelUpdated=function(){},t.Model.dataBind=function(e,o,i){e[i]=function(t){return void 0!==t&&e[i].oData.setValue(t),e[i].oData.getValue()},e[i].oData=new t.Data(o[i]),e[i].oData.onValueUpdated=function(t){o[i]=t,e.onModelUpdated.apply(e,[i,t])}},t.Data=function(t){this.value=t},t.Data.prototype.setValue=function(t){this.value=t,this.onValueUpdated(this.value)},t.Data.prototype.getValue=function(){return this.value},t.Data.prototype.onValueUpdated=function(){},t.Presenter=function(e,o,i){this.map={},this.view=o||null,this.model=i||null,this.config=e,t.each(e,function(t,e){this.map[t]=e,this.view&&this.bindToView(t)},this)},t.Presenter.prototype.bindToView=function(e){var o=this.view,i=this.model;t.each(this.map[e],function(n,r){var s=o.getNode(e);t.dom(s).on(n,function(t){r.apply(s,[t,i,o])})})},t.Presenter.prototype.routeEvent=function(e){var o,i=e.target;t.each(-1!==i.className.indexOf(" ")?i.className.split(" "):[i.className],function(t){"jMVP"===t.substring(0,4)&&(o=t.substring(5,t.length),this.map.hasOwnProperty(o)&&this.map[o][e.type]&&this.map[o][e.type].apply(i,[e,this.view,this.model]))},this)},t.Presenter.prototype.getConfig=function(){return this.config},t.Presenter.prototype.getMap=function(){return this.map},t.Presenter.prototype.isInMap=function(t){return this.map[t]?!0:!1},t.Presenter.prototype.getModel=function(){return this.model},t.Presenter.prototype.getView=function(){return this.view},t.each=function(t,e,o){var i;if(t.constructor===Object&&t.constructor!==Array)for(i in t)t.hasOwnProperty(i)&&t[i]&&e.apply(o,[i,t[i]]);else("string"==typeof t||t instanceof Array)&&("string"==typeof t?t.split(""):t).forEach(function(t,i){e.apply(o,[t,i])})},t.error=function(t,e){throw Error(t+" - Error: "+e)},t.View=function(e,o){return e?(this.config=e,this.nodeMap={},this.loopMap={},this.refMap={},this.domView=t.View.emptyDomView(e),o&&this.parse(),void 0):(t.error("jMVP.View: Configuration object missing!",101),void 0)},t.View.prototype.parse=function(e,o){t.each(e||this.config,function(t,e){var i=this.createNode(t,e.tag);this.storeNode(t,i),(o||this.domView).appendChild(i),e.children&&this.parse(e.children,i),e.hook&&this.hook(e.hook,i),e.loop&&this.storeLoop(e.loop,i)},this)},t.View.prototype.update=function(t,e){this.refMap[t]&&(("string"==typeof e||e.constructor==Boolean)&&this.applyHooks(t,e),e.constructor==Array&&this.applyHooks(t,e.join(", "))),this.loopMap[t]&&this.loop(t,e)},t.View.prototype.loop=function(e,o){var i=o.length;t.each(this.loopMap[e],function(n){t.each(n.template,function(t,e){this.loopNodes(i,n,e,t)},this),this.applyHooks(e,o)},this)},t.View.prototype.loopNodes=function(e,o,i,n){var r=this.nodeMap[n],s=r?r.length:0,a=0;if(0===s)a=e;else if(s!==e)if(e>s)a=e-s;else{a=s-e;for(var p=0,h=o.parent;a>p;p++)h.removeChild(r[s-(p+1)]);a=0}r=this.doNodes(a,i.tag,n),t.each(r,function(t){o.parent.appendChild(t),this.hook(i.hook,t)},this)},t.View.prototype.doNodes=function(t,e,o){for(var i=0,n=[];t>i;i++){var r=this.createNode(o,e);this.storeNode(o,r),n.push(r)}return n},t.View.prototype.storeLoop=function(t,e){var o=t.source;t.parent=e,this.loopMap[o]||(this.loopMap[o]=[]),this.loopMap[o].push(t)},t.View.prototype.hook=function(e,o){t.each(e,function(e,i){t.View.hooks[e]&&this.storeHook(o,e,i)},this)},t.View.prototype.storeHook=function(e,o,i){"string"==typeof i?(this.refMap[i]||(this.refMap[i]={}),this.refMap[i][o]||(this.refMap[i][o]=[]),this.refMap[i][o].push(e)):t.each(i,function(t,i){this.refMap[i]||(this.refMap[i]={}),this.refMap[i][o]||(this.refMap[i][o]={}),this.refMap[i][o][t]||(this.refMap[i][o][t]=[]),this.refMap[i][o][t].push(e)},this)},t.View.prototype.applyHooks=function(e,o){var i=o.constructor==Array?o:[o];t.each(this.refMap[e]||[],function(e,o){o[0]?t.each(i,function(i,n){t.View.hooks[e](o[n],i)}):t.each(o,function(o,n){t.each(i,function(i,r){t.View.hooks[e](n[r],o,i)})})})},t.View.prototype.createNode=function(e,o){var i=t.dom.createNode(o);return i.className=e,i},t.View.prototype.storeNode=function(t,e){if(this.nodeMap[t]){if(this.nodeMap[t].constructor!=Array){var o=this.nodeMap[t];this.nodeMap[t]=[],this.nodeMap[t].push(o)}this.nodeMap[t].push(e)}else this.nodeMap[t]=e},t.View.prototype.render=function(t){t.appendChild(this.domView),this.domView=t.childNodes[t.childNodes.length-1]},t.View.prototype.isInMap=function(t){var e=this.map[t]||this.loopMap[t]||null;return e?!0:!1},t.View.prototype.getConfig=function(){return this.config},t.View.prototype.getNodeMap=function(){return this.nodeMap},t.View.prototype.getNode=function(t){return this.nodeMap[t]||null},t.View.prototype.getLoopMap=function(){return this.loopMap},t.View.prototype.getRefMap=function(){return this.refMap},t.View.prototype.getDomView=function(){return this.domView},t.View.hooks={text:function(e,o){t.dom(e).text(o)},html:function(e,o){t.dom(e).html(o)},attr:function(e,o,i){t.dom(e)[(i===!1||null===i?"rm":"set")+"Attr"](o,i)},css:function(e,o,i){t.dom(e)[(i?"add":"remove")+"Class"](o)},display:function(e,o){t.dom(e).display(o)}},t.View.emptyDomView=function(e){var o;return e.tag?(o=t.dom.createNode(e.tag),delete e.tag):o=t.dom.createNode(),e.id&&(o.id=e.id,delete e.id),e.className&&(o.className=e.className,delete e.className),o},window.jMVP=t})();