(function(){var t=function(e,o,n){this.oRawModel=e,this.oRawView=o,this.oRawPresenter=n,this.model=new t.Model(e),this.view=new t.View(o),this.presenter=new t.Presenter(n,this.view,this.model),this.addModelListener(),this.applyModelToView()};t.prototype.addModelListener=function(){this.model.onModelUpdated=function(t,e){this.view.update(t,e)}.bind(this)},t.prototype.applyModelToView=function(){t.each(this.oRawModel,function(t,e){this.view.oMap[t]&&this.view.update(t,e)},this)},t.prototype.getRawModel=function(){return this.oRawModel},t.prototype.getRawView=function(){return this.oRawView},t.prototype.getRawPresenter=function(){return this.oRawPresenter},t.CSS_PREFIX="jmvp-",t.oModels={},t.oViews={},t.oPresenters={},t.load=function(t,e){console.log(t,e)},t.model=function(e,o){t.oModels[e]=o},t.getModel=function(e){return t.oModels[e]||null},t.getView=function(e){return t.oViews[e]||null},t.getPresenter=function(e){return t.oPresenters[e]||null},t.view=function(e,o){t.oViews[e]=o},t.presenter=function(e,o){t.oPresenters[e]=o},t.each=function(t,e,o){var n;if(t.constructor===Object&&t.constructor!==Array)for(n in t)t[n]&&e.apply(o,[n,t[n]]);else("string"==typeof t||t instanceof Array)&&("string"==typeof t?t.split(""):t).forEach(function(t,n){e.apply(o,[t,n])})},t.error=function(t,e){if(!window.console||!console.error)throw t+""+e;console.error(t,e)},t.Model=function(e){t.each(e,function(o){t.Model.dataBind(this,e,o)},this)},t.Model.prototype.onModelUpdated=function(){},t.Model.dataBind=function(e,o,n){e[n]=new t.Data(o[n]),e[n].onValueUpdated=function(t){o[n]=t,e.onModelUpdated.apply(e,[n,t])}},t.Data=function(t){this.vValue=t},t.Data.prototype.setValue=function(t){this.vValue=t,this.onValueUpdated(this.vValue)},t.Data.prototype.getValue=function(){return this.vValue},t.Data.prototype.onValueUpdated=function(){},t.Presenter=function(e,o,n){this.oMap={},this.view=o||null,this.model=n||null,t.each(e,function(t,e){this.oMap[t]=e,this.view&&this.bindToView(t)},this)},t.Presenter.prototype.bindToView=function(e){var o=this.view,n=this.model;t.each(this.oMap[e],function(i,r){var s=t.dom(this.view.eDomView).getByClass(t.CSS_PREFIX+e);t.dom(s).on(i,function(t){r.apply(s,[t,n,o])})},this)},t.Presenter.prototype.routeEvent=function(e){var o,n=e.target;t.each(-1!==n.className.indexOf(" ")?n.className.split(" "):[n.className],function(t){"jMVP"===t.substring(0,4)&&(o=t.substring(5,t.length),this.oMap.hasOwnProperty(o)&&this.oMap[o].hasOwnProperty(e.type)&&this.oMap[o][e.type].apply(n,[e,this.view,this.model]))},this)},t.Presenter.prototype.getMap=function(){return this.oMap},t.Presenter.prototype.isInMap=function(t){return this.oMap[t]?!0:!1},t.Presenter.prototype.getModel=function(){return this.model},t.Presenter.prototype.getView=function(){return this.view},t.View=function(e){this.oRawView=e,this.oMap={},this.eDomView=t.View.parseObject(this.oRawView,this.oMap)},t.View.prototype.render=function(t){t.appendChild(this.eDomView),this.eDomView=t.childNodes[t.childNodes.length-1]},t.View.prototype.update=function(e,o){t.each(this.oMap[e],function(e,n){"attributes"===e||"classNames"===e?t.each(n,function(n,i){t.View.hooks[e](i,o,n)}):t.View.hooks[e](n,o)},this)},t.View.hooks={text:function(e,o){t.dom(e).text(o)},html:function(e,o){t.dom(e).html(o)},attributes:function(e,o,n){t.dom(e)[(o===!1||null===o?"rm":"set")+"Attr"](n,o)},classNames:function(e,o,n){t.dom(e)[(o?"add":"remove")+"Class"](n)}},t.View.parseObject=function(e,o,n){var i=n||document.createElement("div");return t.each(e,function(e,n){var r=document.createElement(n.tag||"div");r.className=t.CSS_PREFIX+e,t.View.parseHooks(o,e,n,r),n.children&&t.View.parseObject(n.children,o,r),i.appendChild(r)}),i},t.View.parseHooks=function(e,o,n,i){t.each(t.View.hooks,function(o){n[o]&&("attributes"===o||"classNames"===o?t.each(n[o],function(t,n){e[n]||(e[n]={}),e[n][o]||(e[n][o]={}),e[n][o][t]||(e[n][o][t]=[]),e[n][o][t].push(i)}):(e[n[o]]||(e[n[o]]={}),e[n[o]][o]||(e[n[o]][o]=[]),e[n[o]][o].push(i)))})},t.dom=function(e){return new t.dom.Wrap(e)},t.dom.Wrap=function(t){if(!t)throw"jMVP.dom.Wrap requires a node or node list object";return this.aNodes=t[1]?Array.prototype.slice.call(t):t[0]?t:[t],this},t.dom.Wrap.prototype.each=function(e){return t.each(this.aNodes,function(t){e.apply(t)}),this},t.dom.Wrap.prototype.getByClass=function(e){return t.dom.getElementByClassName(e,this.aNodes[0])},t.dom.Wrap.prototype.on=function(e,o){return this.each(function(){t.dom.on(this,e,o)})},t.dom.Wrap.prototype.off=function(e,o){return this.each(function(){t.dom.off(this,e,o)})},t.dom.Wrap.prototype.addClass=function(t){return this.each(function(){this.className+=" "+t})},t.dom.Wrap.prototype.removeClass=function(t){return this.each(function(){this.className=void 0!==this.className?this.className.replace(RegExp(" "+t,"gi"),""):""})},t.dom.Wrap.prototype.text=function(e){return this.each(function(){this[t.dom.INNER_TEXT]=e})},t.dom.Wrap.prototype.html=function(t){return this.each(function(){this.innerHTML=t})},t.dom.Wrap.prototype.setAttr=function(t,e){return this.each(function(){this.setAttribute(t,e)})},t.dom.Wrap.prototype.rmAttr=function(t){return this.each(function(){this.removeAttribute(t)})},t.dom.DIV=document.createElement("div"),t.dom.INNER_TEXT="innerText"in t.dom.DIV?"innerText":"textContent",t.dom.on=t.dom.DIV.addEventListener?function(t,e,o){t.addEventListener(e,o,!1)}:function(t,e,o){t.attachEvent("on"+e,o)},t.dom.off=t.dom.DIV.removeEventListener?function(t,e,o){t.removeEventListener(e,o)}:function(t,e,o){t.detachEvent("on"+e,o)},t.dom.getElementByClassName=t.dom.DIV.querySelector?function(t,e){return e.querySelector("."+t)}:function(e,o){var n=[];return t.dom(o.getElementsByTagName("*")).each(function(){-1!==this.className.indexOf(e)&&n.push(this)}),n[0]},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var o=0,n=this.length;n>o;o++)o in this&&t.call(e,this[o],o,this)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),o=this,n=function(){},i=function(){return o.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i}),window.jMVP=t})();