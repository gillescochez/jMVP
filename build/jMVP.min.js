(function(){var t=function(o,e,n){this.oRawModel=o,this.oRawView=e,this.oRawPresenter=n,this.model=new t.Model(o),this.view=new t.View(e),this.presenter=new t.Presenter(n,this.view,this.model),this.addModelListener(),this.applyModelToView()};t.prototype.addModelListener=function(){this.model.onModelUpdated=function(t,o){this.view.update(t,o)}.bind(this)},t.prototype.applyModelToView=function(){t.each(this.oRawModel,function(t,o){this.view.isInMap(t)&&this.view.update(t,o)},this)},t.prototype.getModel=function(){return this.model},t.prototype.getView=function(){return this.view},t.prototype.getPresenter=function(){return this.presenter},t.prototype.getRawModel=function(){return this.oRawModel},t.prototype.getRawView=function(){return this.oRawView},t.prototype.getRawPresenter=function(){return this.oRawPresenter},t.dom=function(o){return new t.dom.Wrap(o)},t.dom.createNode=function(t){return document.createElement(t||"div")},t.dom.Wrap=function(t){if(!t)throw"jMVP.dom.Wrap requires a node or node list object";return this.aNodes=t[1]?Array.prototype.slice.call(t):t[0]?t:[t],this},t.dom.Wrap.prototype.each=function(o){return t.each(this.aNodes,function(t){o.apply(t)}),this},t.dom.Wrap.prototype.on=function(o,e){return this.each(function(){t.dom.on(this,o,e)})},t.dom.Wrap.prototype.off=function(o,e){return this.each(function(){t.dom.off(this,o,e)})},t.dom.Wrap.prototype.addClass=function(t){return this.each(function(){this.className+=" "+t})},t.dom.Wrap.prototype.removeClass=function(t){return this.each(function(){this.className=void 0!==this.className?this.className.replace(RegExp(" "+t,"gi"),""):""})},t.dom.Wrap.prototype.text=function(o){return this.each(function(){this[t.dom.INNER_TEXT]=o})},t.dom.Wrap.prototype.html=function(t){return this.each(function(){this.innerHTML=t})},t.dom.Wrap.prototype.setAttr=function(t,o){return this.each(function(){this.setAttribute(t,o)})},t.dom.Wrap.prototype.rmAttr=function(t){return this.each(function(){this.removeAttribute(t)})},t.dom.Wrap.prototype.display=function(t){var o=t!==!1?"":"none";return this.each(function(){this.style.display=o})},t.dom.DIV=document.createElement("div"),t.dom.INNER_TEXT="innerText"in t.dom.DIV?"innerText":"textContent",t.dom.on=t.dom.DIV.addEventListener?function(t,o,e){t.addEventListener(o,e,!1)}:function(t,o,e){t.attachEvent("on"+o,e)},t.dom.off=t.dom.DIV.removeEventListener?function(t,o,e){t.removeEventListener(o,e)}:function(t,o,e){t.detachEvent("on"+o,e)},t.Model=function(o){t.each(o,function(e){t.Model.dataBind(this,o,e)},this)},t.Model.prototype.onModelUpdated=function(){},t.Model.dataBind=function(o,e,n){o[n]=function(t){return void 0!==t&&o[n].oData.setValue(t),o[n].oData.getValue()},o[n].oData=new t.Data(e[n]),o[n].oData.onValueUpdated=function(t){e[n]=t,o.onModelUpdated.apply(o,[n,t])}},t.Data=function(t){this.vValue=t},t.Data.prototype.setValue=function(t){this.vValue=t,this.onValueUpdated(this.vValue)},t.Data.prototype.getValue=function(){return this.vValue},t.Data.prototype.onValueUpdated=function(){},t.Presenter=function(o,e,n){this.oMap={},this.view=e||null,this.model=n||null,this.oConfig=o,t.each(o,function(t,o){this.oMap[t]=o,this.view&&this.bindToView(t)},this)},t.Presenter.prototype.bindToView=function(o){var e=this.view,n=this.model;t.each(this.oMap[o],function(i,s){var r=this.view.getElement(o);t.dom(r).on(i,function(t){s.apply(r,[t,n,e])})},this)},t.Presenter.prototype.routeEvent=function(o){var e,n=o.target;t.each(-1!==n.className.indexOf(" ")?n.className.split(" "):[n.className],function(t){"jMVP"===t.substring(0,4)&&(e=t.substring(5,t.length),this.oMap.hasOwnProperty(e)&&this.oMap[e][o.type]&&this.oMap[e][o.type].apply(n,[o,this.view,this.model]))},this)},t.Presenter.prototype.getConfig=function(){return this.oConfig},t.Presenter.prototype.getMap=function(){return this.oMap},t.Presenter.prototype.isInMap=function(t){return this.oMap[t]?!0:!1},t.Presenter.prototype.getModel=function(){return this.model},t.Presenter.prototype.getView=function(){return this.view},t.each=function(t,o,e){var n;if(t.constructor===Object&&t.constructor!==Array)for(n in t)t[n]&&o.apply(e,[n,t[n]]);else("string"==typeof t||t instanceof Array)&&("string"==typeof t?t.split(""):t).forEach(function(t,n){o.apply(e,[t,n])})},t.error=function(t,o){throw t+" - Error: "+o},t.View=function(t){this.oConfig=t,this.oMap={},this.oNodesMap={},this.oLoopMap={},this.eDomView=this.generate(t)},t.View.prototype.update=function(t,o){this.oLoopMap[t]?this.updateLoop(t,o):this.oMap[t]&&this.updateHooks(t,o)},t.View.prototype.updateHooks=function(o,e){t.each(this.oMap[o],function(o,n){t.View.hooks[o]&&("attributes"==o||"classNames"==o?t.each(n,function(n,i){t.View.hooks[o](i,e,n)}):t.View.hooks[o](n,e))},this)},t.View.prototype.updateLoop=function(o,e){t.each(this.oLoopMap[o],function(n){var i=n.parent,s=n.config.template;this.oMap[o]&&this.oMap[o].nNodesCount/this.oMap[o].nHooksCount===e.length||(t.dom(i).html(""),t.each(e,function(){var t=document.createElement("div");this.generate(s,t),i.appendChild(t.childNodes[0])},this)),t.each(this.oMap[o],function(o,n){t.each(e,function(e,s){t.View.hooks[o]&&("attributes"==o||"classNames"==o?t.each(n,function(n){t.View.hooks[o](i.childNodes[s],e,n)}):t.View.hooks[o](i.childNodes[s],e))},this)},this)},this)},t.View.prototype.generate=function(o,e){var n=e||document.createElement("div");return t.each(o,function(t,o){var e=document.createElement(o.tag||"div");this.oNodesMap[t]=e,e.className=t,this.mapHooks(o,e),o.loop&&this.mapLoop(t,o.loop,e),o.children&&this.generate(o.children,e),n.appendChild(e)},this),n},t.View.prototype.mapHooks=function(o,e){t.each(t.View.hooks,function(n){o[n]&&("attributes"===n||"classNames"===n?t.each(o[n],function(t,o){this.oMap[o]||(this.oMap[o]={nNodesCount:0,nHooksCount:0}),this.oMap[o][n]||(this.oMap[o][n]={},this.oMap[o].nHooksCount++),this.oMap[o][n][t]||(this.oMap[o][n][t]=[]),this.oMap[o][n][t].push(e),this.oMap[o].nNodesCount++},this):(this.oMap[o[n]]||(this.oMap[o[n]]={nNodesCount:0,nHooksCount:0}),this.oMap[o[n]][n]||(this.oMap[o[n]][n]=[],this.oMap[o[n]].nHooksCount++),this.oMap[o[n]][n].push(e),this.oMap[o[n]].nNodesCount++))},this)},t.View.prototype.mapLoop=function(o,e,n){e.source&&e.template||t.error("View loop object require both a source and template"),this.oLoopMap[e.source]||(this.oLoopMap[e.source]=[]),this.oLoopMap[e.source].push({config:e,parent:n})},t.View.prototype.render=function(t){t.appendChild(this.eDomView),this.eDomView=t.childNodes[t.childNodes.length-1]},t.View.prototype.getConfig=function(){return this.oConfig},t.View.prototype.getMap=function(){return this.oMap},t.View.prototype.isInMap=function(t){var o=this.oMap[t]||this.oLoopMap[t]||null;return o?!0:!1},t.View.prototype.getElement=function(t){return this.oNodesMap[t]||null},t.View.prototype.getDOM=function(){return this.eDomView},t.View.hooks={text:function(o,e){t.dom(o).text(e)},html:function(o,e){t.dom(o).html(e)},attributes:function(o,e,n){t.dom(o)[(e===!1||null===e?"rm":"set")+"Attr"](n,e)},classNames:function(o,e,n){t.dom(o)[(e?"add":"remove")+"Class"](n)}},window.jMVP=t})();